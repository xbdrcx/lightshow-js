// Lightshow v2.1, Bruno Cruz @ https://github.com/xbdrcx
var lightsMenusState=!1,menuState=!0,ligthsPlaying=!1,lights=!1,lightTypeButtons=document.querySelectorAll("input[name='lightType']"),lightPositionButtons=document.querySelectorAll("input[name='lightPosition']"),usedPositions=[],laserGroups=[],lasersColor="red",lasersState=!0,lasersMoving=!1,laserAperture=2,numLasers=15,angleAperture=450,minLaserAngle=-angleAperture/numLasers,maxLaserAngle=angleAperture/numLasers,beams=[],beamsColor="white",beamsState=!0,beamsMoving=!1,beamAperture=20,beamIntensity=.6,movementSpeed=150,lightDistance=document.getElementById("lights-container").offsetHeight,strobeSpeed=100,lightsStrobe=!1,lightsStrobeInterval=null,screenStrobe=!1,screenStrobeInterval=null,lightsTop=[!1,!1,!1,!1,!1,!1,!1],lightsBottom=[!1,!1,!1,!1,!1,!1,!1],lightsLeft=[!1,!1,!1,!1,!1],lightsRight=[!1,!1,!1,!1,!1],lightElements=[lightsTop,lightsBottom,lightsLeft,lightsRight];const menuContainer=document.getElementById("lights-menu"),lightsContainer=document.getElementById("lights-container"),autoLightsButtons=document.getElementsByClassName("autolightsBtn"),flashButton=document.getElementById("flashScreenBtn"),strobeScreenButton=document.getElementById("strobeScreenBtn"),strobeLightsButton=document.getElementById("strobeLightsBtn"),confirmAddLight=document.getElementById("addLightBtn"),openAboutButtons=document.getElementsByClassName("openAboutBtn"),openAddLightButtons=document.getElementsByClassName("openLightBtn"),openManageLightButtons=document.getElementsByClassName("manageLightBtn"),showhideControlsButtons=document.getElementsByClassName("showhideControlsBtn"),onOffLasersButton=document.getElementById("laserOnOffBtn"),moveLasersButton=document.getElementById("moveLasersBtn"),laserOptionsButton=document.getElementById("lasersDropdown"),onOffBeamsButton=document.getElementById("beamsOnOffBtn"),moveBeamsButton=document.getElementById("beamMotionBtn"),showhidemenusButton=document.getElementById("showhideMenusBtn"),removeLightButton=document.getElementById("removeLightBtn");class LaserBeams{constructor(e,t){let o=document.getElementsByClassName("laserBeams").length;this.laserBeams=document.createElement("div"),this.laserBeams.classList.add("laserBeams"),this.laserBeams.id="lasers"+o,this.lightPosition=e+"-"+t;var n=12.5*(parseInt(t)+1);for(let t=0;t<numLasers+1;t++){var s=document.createElement("div");s.classList.add("laser");let o=minLaserAngle+4*t;s.style.transform="rotate("+o+"deg)",s.style.borderTop=lightDistance+"px solid "+lasersColor,s.style.borderLeft=laserAperture+"px solid transparent",s.style.borderRight=laserAperture+"px solid transparent",this.laserBeams.appendChild(s),"top"==e?(s.style.transformOrigin="top",this.laserBeams.style.marginLeft=n+"%"):"bottom"==e?(s.style.transformOrigin="bottom",this.laserBeams.style.marginLeft=n+"%"):"left"==e?s.style.transformOrigin="left":"right"==e&&(s.style.transformOrigin="right")}lightsContainer.appendChild(this.laserBeams),this.movementEffect=!1,this.movementInterval=null,this.randLaserColorEffect=!1,this.randLaserColorInterval=null,this.randGroupColorEffect=!1,this.randGroupColorInterval=null,this.strobe(),lasersState||(this.laserBeams.style.display="none"),lasersMoving&&this.movement()}turnOn(){this.laserBeams.style.display=""}turnOff(){this.laserBeams.style.display="none"}changeColor(e){for(var t=0;t<this.laserBeams.children.length;t++)this.laserBeams.children[t].style.borderTop=lightDistance+"px solid "+e}randomGroupColor(){if(this.randGroupColorEffect){this.randGroupColorEffect=!1,clearInterval(this.randGroupColorInterval);for(var e=document.getElementById("laserColor").value,t=0;t<this.laserBeams.children.length;t++)this.laserBeams.children[t].style.backgroundColor=e}else{var o=this.laserBeams;this.randGroupColorEffect=!0,this.randGroupColorInterval=setInterval((function(){randGroupColor(o)}),50)}}randomLaserColor(){if(this.randLaserColorEffect){this.randLaserColorEffect=!1,clearInterval(this.randLaserColorInterval);for(var e=0;e<this.laserBeams.children.length;e++)this.laserBeams.children[e].style.borderTop=lightDistance+"px solid "+lasersColor}else{this.randLaserColorEffect=!0;var t=this.laserBeams;this.randLaserColorInterval=setInterval((function(){randLasColor(t)}),50)}}strobe(){var e=this.laserBeams;setInterval((function(){strobeLasers2(e)}),50)}movement(){if(this.movementEffect){this.movementEffect=!1,clearInterval(this.movementInterval);for(let e=0;e<this.laserBeams.children.length;e++){let t=minLaserAngle+4*e;this.laserBeams.children[e].style.transform="rotate("+t+"deg)"}lasersMoving=!1}else this.movementEffect=!0,lasersMoving=!0,laserMovement(this)}}function randGroupColor(e){let t=Math.floor(16777215*Math.random()).toString(16);for(var o=0;o<e.children.length;o++)e.children[o].style.borderTop=lightDistance+"px solid "+t}function randLasColor(e){for(var t=0;t<e.children.length;t++){let o=Math.floor(16777215*Math.random()).toString(16);e.children[t].style.borderTop=lightDistance+"px solid "+o}}function strobeLasers2(e){for(let t=0;t<e.children.length;t++){let o=(.8*Math.random()+.1).toFixed(2);e.children[t].style.opacity=o}}function laserMovement(e){e.movementInterval=setInterval((function(){for(let o=0;o<e.laserBeams.children.length;o++){var t=(Math.random()*(maxLaserAngle-minLaserAngle)+minLaserAngle).toFixed(0);e.laserBeams.children[o].style.transform="rotate("+t+"deg)"}}),movementSpeed)}class LightBeam{constructor(e,t){let o=document.getElementsByClassName("lightbeam").length;this.lightbeam=document.createElement("div"),this.lightbeam.classList.add("lightbeam"),this.lightbeam.id="beam"+o,this.lightPosition=e+"-"+t;var n=12.25*(parseInt(t)+1);this.lightbeam.style.borderLeft=beamAperture+"px solid transparent",this.lightbeam.style.borderRight=beamAperture+"px solid transparent",this.lightbeam.style.marginLeft=n+"%",this.lightbeam.style.opacity=beamIntensity,"top"==e?(this.lightbeam.style.transformOrigin="top",this.lightbeam.style.borderBottom=lightDistance+"px solid "+beamsColor,this.lightbeam.style.borderBottomLeftRadius="18px",this.lightbeam.style.borderBottomRightRadius="18px"):"bottom"==e?(this.lightbeam.style.transformOrigin="bottom",this.lightbeam.style.borderTop=lightDistance+"px solid "+beamsColor,this.lightbeam.style.borderTopLeftRadius="18px",this.lightbeam.style.borderTopRightRadius="18px"):"left"==e?(this.lightbeam.style.transformOrigin="left",this.lightbeam.style.borderRight=lightDistance+"px solid "+beamsColor,this.lightbeam.style.borderTopRightRadius="18px",this.lightbeam.style.borderBottomRightRadius="18px"):"right"==e&&(this.lightbeam.style.transformOrigin="right",this.lightbeam.style.borderLeft=lightDistance+"px solid "+beamsColor,this.lightbeam.style.borderTopLeftRadius="18px",this.lightbeam.style.borderBottomLeftRadius="18px"),lightsContainer.appendChild(this.lightbeam),this.movementEffect=!1,this.movementInterval=null,this.randBeamColorEffect=!1,this.randBeamColorInterval=null,beamsState||(this.lightbeam.style.display="none"),beamsMoving&&this.movement()}turnOn(){this.lightbeam.style.opacity=beamIntensity}turnOff(){this.lightbeam.style.opacity=0}changeColor(e){var t=this.lightPosition.split("-")[0];"top"==t?this.lightbeam.style.borderBottom=lightDistance+"px solid "+e:"bottom"==t?this.lightbeam.style.borderTop=lightDistance+"px solid "+e:"left"==t?this.lightbeam.style.borderRight=lightDistance+"px solid "+e:"right"==t&&(this.lightbeam.style.borderLeft=lightDistance+"px solid "+e)}randomColor(){if(this.randBeamColorEffect)this.randBeamColorEffect=!1,clearInterval(this.randBeamColorInterval);else{this.randBeamColorEffect=!0;this.lightbeam;this.randBeamColorInterval=setInterval((function(){}),50)}}strobe(){this.lightbeam;setInterval((function(){}),50)}movement(){this.movementEffect?(this.movementEffect=!1,beamsMoving=!1,this.lightbeam.classList.remove("horizonmotion")):(this.movementEffect=!0,beamsMoving=!0,this.lightbeam.classList.add("horizonmotion"))}}function flashScreen(){document.body.style.backgroundColor="white",document.getElementById("apptitle").style.color="black";var e=document.getElementsByName("menuButton");e.forEach((e=>{e.style.color="black"})),document.getElementById("openCommands").children[0].src="../icons/keyboard.ico";for(let e=0;e<openAboutButtons.length;e++)openAboutButtons[e].children[0].src="../icons/info.png";setTimeout((function(){document.body.style.backgroundColor="black",document.getElementById("apptitle").style.color="white",e.forEach((e=>{e.style.color="white"})),document.getElementById("openCommands").children[0].src="../icons/keyboard_white.ico";for(let e=0;e<openAboutButtons.length;e++)openAboutButtons[e].children[0].src="../icons/white_info.png"}),100)}function randomLasersColor(){for(let e=0;e<laserGroups.length;e++)laserGroups[e].randomLaserColor()}function randomLaserGroupColor(){for(let e=0;e<laserGroups.length;e++)laserGroups[e].randomGroupColor()}function moveLasers(){for(let e=0;e<laserGroups.length;e++)laserGroups[e].movement()}function beamMotion(){for(let e=0;e<beams.length;e++)beams[e].movement()}function createLasers(){var e=new LaserBeams;laserGroups.push(e)}function strobeScreen(){screenStrobe?(screenStrobe=!1,clearInterval(screenStrobeInterval)):(screenStrobe=!0,screenStrobeInterval=setInterval((function(){flashButton.click()}),strobeSpeed))}function strobeLights(){lightsStrobe?(lightsStrobe=!1,clearInterval(lightsStrobeInterval)):(lightsStrobe=!0,lightsStrobeInterval=setInterval((function(){onOffLasersButton.click(),onOffBeamsButton.click()}),strobeSpeed))}function addLightElement(){var e=document.querySelector('input[name="lightType"]:checked').value;document.querySelectorAll("input[name='lightPosition']:checked").forEach((t=>{let o=t.value.split("-")[0],n=t.value.split("-")[1];if("lightbeam"==e){var s=new LightBeam(o,n);beams.push(s),document.querySelector("input[name='lightPosition']:checked").innerHTML="B"}else if("lasers"==e){var l=new LaserBeams(o,n);laserGroups.push(l),document.querySelector("input[name='lightPosition']:checked").innerHTML="L"}usedPositions.push(t.value),"top"==o?lightsTop[n]=!0:"bottom"==o?lightsBottom[n]=!0:"left"==o?lightsLeft[n]=!0:"right"==o&&(lightsRight[n]=!0)})),showhidemenusButton.removeAttribute("disabled"),resetAddLightModal(),activateButtons(),lights=!0}function autoLights(e){1==e[0]&&onOffLasersButton.click(),1==e[1]&&onOffBeamsButton.click(),1==e[2]&&flashButton.click(),1==e[3]&&moveLasers()}function resetAddLightModal(){$("#addLightModal").modal("hide"),lightPositionButtons.forEach((e=>{e.setAttribute("disabled",!0)})),confirmAddLight.setAttribute("disabled",!0),lightPositionButtons.forEach((e=>{e.setAttribute("disabled",!0)}));for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++)"checkbox"==e[t].type&&(e[t].checked=!1),"radio"==e[t].type&&(e[t].checked=!1)}function activateButtons(){flashButton.removeAttribute("disabled"),strobeLightsButton.removeAttribute("disabled"),strobeScreenButton.removeAttribute("disabled");for(let e=0;e<autoLightsButtons.length;e++)autoLightsButtons[e].removeAttribute("disabled");for(let e=0;e<openManageLights.length;e++)openManageLightButtons[e].removeAttribute("disabled");for(let e=0;e<showhideControlsButtons.length;e++)showhideControlsButtons[e].removeAttribute("disabled")}function disabledButtons(){flashButton.setAttribute("disabled",!0),strobeLightsButton.setAttribute("disabled",!0),strobeScreenButton.setAttribute("disabled",!0);for(let e=0;e<autoLightsButtons.length;e++)autoLightsButtons[e].setAttribute("disabled",!0);for(let e=0;e<openManageLights.length;e++)openManageLightButtons[e].setAttribute("disabled",!0);for(let e=0;e<showhideControlsButtons.length;e++)showhideControlsButtons[e].setAttribute("disabled",!0)}function removeLight(){let e=document.querySelector("input[name='manageLightType']:checked").value,t=document.querySelector("input[name='manageLightPosition']:checked");if("lightbeam"==e)for(let e=0;e<beams.length;e++)beams[e].lightPosition==t.id&&(beams[e].lightbeam.remove(),beams.splice(e,1));if("lasers"==e)for(let e=0;e<laserGroups.length;e++)laserGroups[e].lightPosition==t.id&&(laserGroups[e].laserBeams.remove(),laserGroups.splice(e,1));t.setAttribute("checked",!1),t.setAttribute("disabled",!0),0==laserGroups.length&&0==beams.length&&(lights=!1,disabledButtons()),usedPositions.forEach((e=>{e==t.value&&(index=usedPositions.indexOf(e),usedPositions.splice(index,1))}))}function randomizeLights(){var e=lightsTop.length+lightsBottom.length+lightsLeft.length+lightsRight.length,t=Boolean(Math.round(Math.random())),o=Boolean(Math.round(Math.random())),n=["top","bottom","left","right"];if(t){var s=(Math.random()*e/2).toFixed(0);for(let e=0;e<s;e++){let e=n[Math.floor(Math.random()*n.length)];if("top"==e){selectedPosition.value.split("-")[1]}else if("bottom"==e){selectedPosition.value.split("-")[1]}else if("left"==e){selectedPosition.value.split("-")[1]}else if("right"==e){selectedPosition.value.split("-")[1]}var l=new LightBeam(e,lightNumber);beams.push(l)}}if(o)(Math.random()*e/2).toFixed(0);if("lightbeam"==lightType){l=new LightBeam(lightOrientation,lightNumber);beams.push(l),document.querySelector("input[name='lightPosition']:checked").innerHTML="B"}else if("lasers"==lightType){var r=new LaserBeams(lightOrientation,lightNumber);laserGroups.push(r),document.querySelector("input[name='lightPosition']:checked").innerHTML="L"}usedPositions.push(selectedPosition.value),"top"==lightOrientation?lightsTop[lightNumber]=!0:"bottom"==lightOrientation?lightsBottom[lightNumber]=!0:"left"==lightOrientation?lightsLeft[lightNumber]=!0:"right"==lightOrientation&&(lightsRight[lightNumber]=!0)}document.body.onkeypress=function(e){lights&&("z"===e.key||"KeyZ"===e.code?flashScreen():"a"===e.key||"KeyA"===e.code?onOffLasersButton.click():"h"===e.key||"KeyH"===e.code?moveLasersButton.click():"q"===e.key||"KeyQ"===e.code?onOffBeamsButton.click():"y"===e.key||"KeyY"===e.code?moveBeamsButton.click():"x"===e.key||"KeyX"===e.code?strobeLights():"c"===e.key||"KeyC"===e.code?strobeScreen():"m"===e.key||"KeyM"===e.code?hideMenu():"n"!==e.key&&"KeyN"!==e.code||showhidemenusButton.click())},flashButton.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),flashScreen()})),document.getElementById("laserSpeed").addEventListener("input",(function(){movementSpeed=this.value,moveLasers()})),document.getElementById("laserIntensity").addEventListener("input",(function(){for(let e=0;e<laserGroups.length;e++)laserGroups[e].laserBeams.style.opacity=this.value/10})),document.getElementById("laserColor").addEventListener("input",(function(){for(let e=0;e<laserGroups.length;e++)laserGroups[e].changeColor(this.value)})),document.getElementById("beamIntensity").addEventListener("input",(function(){beamIntensity=this.value/10;for(let e=0;e<beams.length;e++)beams[e].lightbeam.style.opacity=beamIntensity})),document.getElementById("beamColor").addEventListener("input",(function(){beamsColor=this.value;for(let e=0;e<beams.length;e++)beams[e].changeColor(this.value)})),onOffBeamsButton.addEventListener("click",(function(){if(beamsState){beamsState=!1,document.getElementById("beamsStateColor").style.color="red";for(let e=0;e<beams.length;e++)beams[e].turnOff()}else{beamsState=!0,document.getElementById("beamsStateColor").style.color="green";for(let e=0;e<beams.length;e++)beams[e].turnOn()}})),onOffLasersButton.addEventListener("click",(function(e){if(e.preventDefault(),lasersState){lasersState=!1,document.getElementById("lasersStateColor").style.color="red";for(let e=0;e<laserGroups.length;e++)laserGroups[e].turnOff()}else{lasersState=!0,document.getElementById("lasersStateColor").style.color="green";for(let e=0;e<laserGroups.length;e++)laserGroups[e].turnOn()}})),lightTypeButtons.forEach((e=>{e.addEventListener("click",(function(){lightPositionButtons.forEach((e=>{e.removeAttribute("disabled")}));for(let e=0;e<usedPositions.length;e++)document.getElementById(usedPositions[e]).setAttribute("disabled",!0)}))})),lightPositionButtons.forEach((e=>{e.addEventListener("click",(function(){document.querySelectorAll("input[name='lightPosition']:checked").length>0?confirmAddLight.removeAttribute("disabled"):confirmAddLight.setAttribute("disabled",!0)}))})),document.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(function(){e.blur()}))})),$(".dropdown-menu button, .dropdown-menu label").click((function(e){e.stopPropagation(),e.preventDefault()}));for(let e=0;e<openAboutButtons.length;e++)openAboutButtons[e].addEventListener("click",(function(){$("#aboutModal").modal("show")}));document.getElementById("openCommands").addEventListener("click",(function(){$("#commandsModal").modal("show")}));for(var i=0;i<openAddLightButtons.length;i++)openAddLightButtons[i].addEventListener("click",(function(){for(let e=0;e<usedPositions.length;e++)document.getElementById(usedPositions[e]).setAttribute("disabled",!0);$("#addLightModal").modal("show")}));for(i=0;i<openManageLightButtons.length;i++)openManageLightButtons[i].addEventListener("click",(function(){let e=document.getElementById("manageLightBeams"),t=document.getElementById("manageLasers"),o=document.getElementById("manageLightsModal").querySelectorAll("input[name='manageLightPosition']");o.forEach((e=>{e.setAttribute("disabled",!0)})),beams.length>0&&e.removeAttribute("disabled"),laserGroups.length>0&&t.removeAttribute("disabled"),e.addEventListener("click",(function(){o.forEach((e=>{e.setAttribute("disabled",!0),e.addEventListener("click",(function(){removeLightButton.removeAttribute("disabled")}));for(let t=0;t<beams.length;t++)e.id==beams[t].lightPosition&&e.removeAttribute("disabled")}))})),t.addEventListener("click",(function(){o.forEach((e=>{e.setAttribute("disabled",!0),e.addEventListener("click",(function(){removeLightButton.removeAttribute("disabled")}));for(let t=0;t<laserGroups.length;t++)e.id==laserGroups[t].lightPosition&&e.removeAttribute("disabled")}))})),$("#manageLightsModal").modal("show")}));document.getElementById("cancelAddLight").addEventListener("click",(function(){$("#addLightModal").modal("hide"),resetAddLightModal()})),document.getElementById("closeManageLights").addEventListener("click",(function(){$("#manageLightsModal").modal("hide")}));for(let e=0;e<showhideControlsButtons.length;e++)showhideControlsButtons[e].addEventListener("click",(function(){if(1==lightsMenusState){lightsMenusState=!1,$(".draggableDiv").fadeOut();for(let e=0;e<showhideControlsButtons.length;e++)showhideControlsButtons[e].innerHTML="Show Controls"}else{lightsMenusState=!0,$(".draggableDiv").fadeIn();for(let e=0;e<showhideControlsButtons.length;e++)showhideControlsButtons[e].innerHTML="Hide Controls"}}));function initScreen(){setTimeout((function(){document.getElementsByClassName("splash")[0].style.opacity=0,setTimeout((function(){document.getElementsByClassName("splash")[0].style.display="none"}),500),$("#warningModal").modal("show"),setTimeout((function(){$("#warningModal").modal("hide")}),1500)}),500)}function dragElement(e){var t=0,o=0,n=0,s=0;function dragMouseDown(e){(e=e||window.event).preventDefault(),n=e.clientX,s=e.clientY,document.onmouseup=closeDragElement,document.onmousemove=elementDrag}function elementDrag(l){(l=l||window.event).preventDefault(),t=n-l.clientX,o=s-l.clientY,n=l.clientX,s=l.clientY,e.style.top=e.offsetTop-o+"px",e.style.left=e.offsetLeft-t+"px"}function closeDragElement(){document.onmouseup=null,document.onmousemove=null}document.getElementById(e.id+"Header")?document.getElementById(e.id+"Header").onmousedown=dragMouseDown:e.onmousedown=dragMouseDown}dragElement(document.getElementById("beamMenu")),dragElement(document.getElementById("laserMenu")),dragElement(document.getElementById("lightsMenu")),document.addEventListener("DOMContentLoaded",(function(){initScreen()}));